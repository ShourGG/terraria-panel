import{f as Y,h as Z,i as A,j as H}from"./index-m_r5GfhJ.js";import{d as M,l as u,o as J,c as B,a as e,w as a,K as O,r as s,G as m,f as Q,b as X,n as z,B as n,s as k,q as W,N as ee,Z as le,g as ae,Y as te,e as p,_ as oe}from"./index-DpLe_dtH.js";const re={key:1},se={class:"dialog-footer"},ne=M({name:"TerrariaWorlds"}),de=M({...ne,setup(ie){const w=u([]),b=u(!1),c=u(null),_=u(!1),h=u(!1),V=u(),r=u({name:"",size:"medium",difficulty:"normal",seed:""}),S={name:[{required:!0,message:"请输入世界名称",trigger:"blur"},{min:1,max:20,message:"长度在1到20个字符之间",trigger:"blur"}],size:[{required:!0,message:"请选择世界大小",trigger:"change"}],difficulty:[{required:!0,message:"请选择难度",trigger:"change"}]},v=async()=>{b.value=!0;try{const o=await Y();w.value=o.data}catch{m.error("获取世界列表失败")}finally{b.value=!1}},T=()=>{v()},D=()=>{_.value=!0},F=async()=>{V.value&&await V.value.validate(async o=>{if(o){h.value=!0;try{await Z({name:r.value.name,size:r.value.size,difficulty:r.value.difficulty,seed:r.value.seed||void 0}),m.success("世界创建任务已提交，请稍后刷新查看结果"),_.value=!1,r.value={name:"",size:"medium",difficulty:"normal",seed:""},setTimeout(()=>{v()},5e3)}catch{m.error("创建世界失败")}finally{h.value=!1}}})},U=async o=>{try{c.value=o.path,await A(o.path),m.success(`已选择世界: ${o.name}`),v()}catch{m.error("选择世界失败")}finally{c.value=null}},$=async o=>{try{await te.confirm(`确定要删除世界"${o.name}"吗？该操作不可恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),c.value=o.path,await H(o.path),m.success("世界已删除"),v()}catch(l){l!=="cancel"&&m.error("删除世界失败")}finally{c.value=null}},q=o=>{switch(o){case"small":return"小型";case"medium":return"中型";case"large":return"大型";default:return o}},L=o=>{switch(o){case"normal":return"普通";case"expert":return"专家";case"master":return"大师";case"journey":return"旅行";default:return o}},N=o=>{if(!o)return"0 B";const l=["B","KB","MB","GB","TB"],y=Math.floor(Math.log(o)/Math.log(1024));return parseFloat((o/Math.pow(1024,y)).toFixed(2))+" "+l[y]};return J(()=>{v()}),(o,l)=>{const y=s("el-icon"),f=s("el-button"),d=s("el-table-column"),j=s("el-tag"),E=s("el-table"),K=s("el-empty"),x=s("el-input"),g=s("el-form-item"),i=s("el-option"),C=s("el-select"),R=s("el-form"),G=s("el-dialog"),I=X("loading");return p(),B("div",null,[e(O,{header:"世界管理",icon:"Place"},{headerBtn:a(()=>[e(f,{type:"primary",size:"small",onClick:T},{default:a(()=>[e(y,null,{default:a(()=>[e(W(ee))]),_:1}),l[6]||(l[6]=n(" 刷新 "))]),_:1,__:[6]}),e(f,{type:"success",size:"small",onClick:D},{default:a(()=>[e(y,null,{default:a(()=>[e(W(le))]),_:1}),l[7]||(l[7]=n(" 创建世界 "))]),_:1,__:[7]})]),default:a(()=>[Q((p(),B("div",null,[w.value.length?(p(),z(E,{key:0,data:w.value,style:{width:"100%"}},{default:a(()=>[e(d,{prop:"name",label:"世界名称","min-width":"150"}),e(d,{prop:"size",label:"大小",width:"100"},{default:a(t=>[n(k(q(t.row.size)),1)]),_:1}),e(d,{prop:"difficulty",label:"难度",width:"100"},{default:a(t=>[n(k(L(t.row.difficulty)),1)]),_:1}),e(d,{prop:"isSelected",label:"状态",width:"100"},{default:a(t=>[t.row.isSelected?(p(),z(j,{key:0,type:"success"},{default:a(()=>l[8]||(l[8]=[n("当前选择")])),_:1,__:[8]})):(p(),B("span",re,"-"))]),_:1}),e(d,{prop:"lastModified",label:"最后修改",width:"180"}),e(d,{prop:"fileSizeBytes",label:"文件大小",width:"120"},{default:a(t=>[n(k(N(t.row.fileSizeBytes)),1)]),_:1}),e(d,{label:"操作",width:"220"},{default:a(t=>[e(f,{type:"primary",size:"small",disabled:t.row.isSelected,onClick:P=>U(t.row),loading:c.value===t.row.path},{default:a(()=>l[9]||(l[9]=[n(" 选择 ")])),_:2,__:[9]},1032,["disabled","onClick","loading"]),e(f,{type:"danger",size:"small",disabled:t.row.isSelected,onClick:P=>$(t.row),loading:c.value===t.row.path},{default:a(()=>l[10]||(l[10]=[n(" 删除 ")])),_:2,__:[10]},1032,["disabled","onClick","loading"])]),_:1})]),_:1},8,["data"])):(p(),z(K,{key:1,description:"暂无世界文件"}))])),[[I,b.value]])]),_:1}),e(G,{modelValue:_.value,"onUpdate:modelValue":l[5]||(l[5]=t=>_.value=t),title:"创建新世界",width:"500px","destroy-on-close":""},{footer:a(()=>[ae("span",se,[e(f,{onClick:l[4]||(l[4]=t=>_.value=!1)},{default:a(()=>l[11]||(l[11]=[n("取消")])),_:1,__:[11]}),e(f,{type:"primary",onClick:F,loading:h.value},{default:a(()=>l[12]||(l[12]=[n(" 创建 ")])),_:1,__:[12]},8,["loading"])])]),default:a(()=>[e(R,{model:r.value,"label-width":"100px",rules:S,ref_key:"worldFormRef",ref:V},{default:a(()=>[e(g,{label:"世界名称",prop:"name"},{default:a(()=>[e(x,{modelValue:r.value.name,"onUpdate:modelValue":l[0]||(l[0]=t=>r.value.name=t),placeholder:"请输入世界名称"},null,8,["modelValue"])]),_:1}),e(g,{label:"世界大小",prop:"size"},{default:a(()=>[e(C,{modelValue:r.value.size,"onUpdate:modelValue":l[1]||(l[1]=t=>r.value.size=t),placeholder:"请选择世界大小",style:{width:"100%"}},{default:a(()=>[e(i,{label:"小型",value:"small"}),e(i,{label:"中型",value:"medium"}),e(i,{label:"大型",value:"large"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"难度",prop:"difficulty"},{default:a(()=>[e(C,{modelValue:r.value.difficulty,"onUpdate:modelValue":l[2]||(l[2]=t=>r.value.difficulty=t),placeholder:"请选择难度",style:{width:"100%"}},{default:a(()=>[e(i,{label:"普通",value:"normal"}),e(i,{label:"专家",value:"expert"}),e(i,{label:"大师",value:"master"}),e(i,{label:"旅行",value:"journey"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"种子",prop:"seed"},{default:a(()=>[e(x,{modelValue:r.value.seed,"onUpdate:modelValue":l[3]||(l[3]=t=>r.value.seed=t),placeholder:"可选，留空则随机生成"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),ce=oe(de,[["__scopeId","data-v-a6862e98"]]);export{ce as default};
