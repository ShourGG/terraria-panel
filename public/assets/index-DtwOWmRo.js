import{a5 as x,d as de,l as u,o as Te,m as Ke,r as s,b as A,c as te,e as _,a as e,w as t,f as v,g as ae,p as ne,z as Q,n as S,B as w,G as Be,q as r,s as z,a4 as Me,k as b,E as C,K as D,L as F,M as L,N as Ee,a6 as oe}from"./index-rAFU2v1v.js";const qe=p=>x.get("/koi/sysDept/list",p),Ae=()=>x.get("/koi/sysDept/cascaderList"),Le=p=>x.get("/koi/sysDept/getById/"+p),$e=p=>x.post("/koi/sysDept/update",p),Re=p=>x.post("/koi/sysDept/add",p),Ye=p=>x.post("/koi/sysDept/deleteById/"+p),Pe=p=>x.post("/koi/sysDept/batchDelete",p),Oe=(p,U)=>x.post("/koi/sysDept/updateStatus/"+p+"/"+U),Qe=(p,U)=>x.post("/koi/sysDept/updateSpread/"+p+"/"+U),ze={class:"koi-flex"},Fe={key:0},Ge=de({name:"deptPage"}),He=de({...Ge,setup(p){const U=u(!1),$=u(!0),G=u([{id:1,deptId:1,deptName:"YU-ADMIN🌻",leader:"YU-ADMIN",phone:"18588888888",email:"xxxxxx@163.com",deptStatus:"0",isSpread:"1",sorted:1,remark:"我是天才🌻",createTime:"2023-08-08 23:00:00",children:[{id:3,deptId:3,deptName:"研发部门🌻",leader:"YU-ADMIN",phone:"18588888888",email:"xxxxxx@163.com",deptStatus:"0",isSpread:"1",sorted:1,remark:"我是天才🌻",createTime:"2023-08-08 23:00:00"},{id:4,deptId:4,deptName:"销售部门🌻",leader:"虎牙688张大仙",phone:"18566666666",email:"666666@163.com",deptStatus:"0",isSpread:"1",sorted:1,remark:"我是天才🌻",createTime:"2023-08-08 23:00:00"}]},{id:2,deptId:2,deptName:"祖安公司🌻",leader:"YU-ADMIN",phone:"18577777777",email:"xxxxxx@163.com",deptStatus:"0",isSpread:"1",sorted:1,remark:"我是天才🌻",createTime:"2023-08-08 23:00:00",children:[{id:5,deptId:5,deptName:"运维部门🌻",leader:"YU-ADMIN",phone:"18577777777",email:"xxxxxx@163.com",deptStatus:"0",isSpread:"1",sorted:1,remark:"我是天才🌻",createTime:"2023-08-08 23:00:00"},{id:6,deptId:6,deptName:"测试部门🌻",leader:"虎牙688张大仙",phone:"18577777777",email:"666666@163.com",deptStatus:"0",isSpread:"1",sorted:1,remark:"我是天才🌻",createTime:"2023-08-08 23:00:00"}]}]),g=u({deptName:"",phone:"",deptStatus:""}),re=()=>{g.value={deptName:"",phone:"",deptStatus:""}},se=()=>{h()},pe=()=>{re(),h()},h=async()=>{},T=async()=>{try{const n=await qe(g.value);G.value=oe(n.data,"deptId"),ue(n.data)}catch{D("数据查询失败，请刷新重试🌻")}},B=u(),ue=n=>{if(n!=null&&n.length!=0){B.value=[];const l=[];n.forEach(d=>{d.parentId=="0"&&d.isSpread=="0"&&l.push(d.deptId),d.parentId!="0"&&d.isSpread=="0"&&(l.push(d.deptId),l.push(d.parentId))});const m=[...new Set(l)];B.value=m.map(String)}else B.value=[]};Te(()=>{h()});const M=u([]),W=u(!0),H=u(!0),ie=n=>{M.value=n.map(l=>l.id),W.value=n.length!=1,H.value=!n.length};let E=u([]);const J=async()=>{try{E.value=[];const n=await Ae();E.value=oe(n.data,"value"),E.value.unshift({label:"最顶级部门",value:"0",parentId:"-1"})}catch{C("部门级联数据查询失败，请重试🌻")}},R=u(!0),Y=u(!1),ce=()=>{R.value=!1,Y.value=!Y.value,Me(()=>{R.value=!0})},me=()=>{K(),P.value="部门添加",J(),o.value.parentId="0",o.value.deptStatus="0",V.value.koiOpen(),b("添加🌻")},fe=async n=>{if(n==null||n==""){L("请选择需要修改的数据🌻");return}try{const l=await Le(n);o.value=l.data}catch{D("数据获取失败，请刷新重试🌻")}},X=async n=>{K(),P.value="部门修改";const l=n?n.id:M.value[0];(l==null||l=="")&&C("请选择需要修改的数据🌻"),J(),fe(l),V.value.koiOpen(),b("修改🌻")},V=u(),P=u("部门管理"),O=u();let o=u({id:null,deptId:null,deptName:null,parentId:null,deptStatus:"0",leader:null,phone:null,email:null,sorted:1});const K=()=>{o.value={id:null,deptId:null,deptName:null,parentId:null,deptStatus:null,leader:null,phone:null,email:null,sorted:1}},ve=Ke({deptId:[{required:!0,message:"请输入部门编号",trigger:"blur"}],deptName:[{required:!0,message:"请输入部门名字",trigger:"blur"}],parentId:[{required:!0,message:"请选择上级部门",trigger:"blur"}],deptStatus:[{required:!0,message:"请输入选择部门状态",trigger:"blur"}],leader:[{required:!0,message:"请输入负责人名字",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号码",trigger:"blur"}],sorted:[{required:!0,message:"请输入排序号",trigger:"blur"}]}),k=u(!1),he=()=>{O.value&&(k.value=!0,O.value.validate(async n=>{if(n)if(o.value.id!=null&&o.value.id!="")try{await $e(o.value),b("修改成功🌻"),k.value=!1,V.value.koiQuickClose(),K(),h()}catch{k.value=!1,D("修改失败，请刷新重试🌻")}else try{await Re(o.value),b("添加成功🌻"),k.value=!1,V.value.koiQuickClose(),K(),h()}catch{k.value=!1,D("添加失败，请刷新重试🌻")}else C("验证失败，请检查填写内容🌻"),k.value=!1}))},_e=()=>{V.value.koiClose()},xe=n=>{let l=n.deptStatus==="0"?"启用":"停用";F("确认要["+l+"]-["+n.deptName+"]部门吗？").then(async()=>{if(K(),!n.id||!n.deptStatus){L("请选择需要修改的数据🌻");return}try{await Oe(n.id,n.deptStatus),b("修改成功🌻")}catch{T(),D("修改失败，请刷新重试🌻")}}).catch(()=>{C("已取消🌻")})},ge=async n=>{if(!n.id||!n.isSpread){L("请选择需要展开的数据🌻");return}try{await Qe(n.id,n.isSpread),T(),b("操作成功🌻")}catch{T(),D("操作失败，请刷新重试🌻")}},ye=n=>{const l=n.id;if(l==null||l==""){L("请选中需要删除的数据🌻");return}F("您确认需要删除部门名称["+n.deptName+"]么？").then(async()=>{try{await Ye(l),b("删除成功🌻"),T()}catch{}}).catch(()=>{C("已取消🌻")})},be=()=>{if(M.value.length==0){Ee("请选择需要删除的数据🌻");return}F("您确认需要进行批量删除么？删除后将无法进行恢复？").then(async()=>{try{await Pe(M.value),b("批量删除成功🌻"),T()}catch{}}).catch(()=>{C("已取消🌻")})};return(n,l)=>{const m=s("el-input"),d=s("el-form-item"),q=s("el-option"),Z=s("el-select"),y=s("el-button"),j=s("el-form"),i=s("el-col"),ke=s("KoiToolbar"),I=s("el-row"),c=s("el-table-column"),ee=s("el-switch"),le=s("el-tooltip"),Se=s("el-table"),we=s("el-cascader"),Ve=s("el-input-number"),Ie=s("KoiDialog"),Ne=s("KoiCard"),Ce=A("throttle"),De=A("debounce"),N=A("auth"),Ue=A("loading");return _(),te("div",ze,[e(Ne,null,{default:t(()=>[v(e(j,{inline:!0},{default:t(()=>[e(d,{label:"部门名称",prop:"deptName"},{default:t(()=>[e(m,{placeholder:"请输入部门名称",modelValue:g.value.deptName,"onUpdate:modelValue":l[0]||(l[0]=a=>g.value.deptName=a),clearable:"",style:{width:"240px"},onKeyup:Q(h,["enter","native"])},null,8,["modelValue"])]),_:1}),e(d,{label:"部门状态",prop:"deptStatus"},{default:t(()=>[e(Z,{placeholder:"请选择部门状态",modelValue:g.value.deptStatus,"onUpdate:modelValue":l[1]||(l[1]=a=>g.value.deptStatus=a),clearable:"",style:{width:"240px"},onKeyup:Q(h,["enter","native"])},{default:t(()=>[e(q,{label:"启用",value:"0"}),e(q,{label:"停用",value:"1"})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"联系电话",prop:"phone"},{default:t(()=>[e(m,{placeholder:"请输入联系电话",modelValue:g.value.phone,"onUpdate:modelValue":l[2]||(l[2]=a=>g.value.phone=a),clearable:"",style:{width:"240px"},onKeyup:Q(h,["enter","native"])},null,8,["modelValue"])]),_:1}),e(d,null,{default:t(()=>[v((_(),S(y,{type:"primary",icon:"search",plain:""},{default:t(()=>l[17]||(l[17]=[w("搜索")])),_:1,__:[17]})),[[Ce,se]]),v((_(),S(y,{type:"danger",icon:"refresh",plain:""},{default:t(()=>l[18]||(l[18]=[w("重置")])),_:1,__:[18]})),[[De,pe]])]),_:1})]),_:1},512),[[Be,$.value]]),e(I,{gutter:10},{default:t(()=>[v((_(),S(i,{span:1.5},{default:t(()=>[e(y,{type:"primary",icon:"plus",plain:"",onClick:l[3]||(l[3]=a=>me())},{default:t(()=>l[19]||(l[19]=[w("新增")])),_:1,__:[19]})]),_:1})),[[N,["system:role:add"]]]),v((_(),S(i,{span:1.5},{default:t(()=>[e(y,{type:"success",icon:"edit",plain:"",onClick:l[4]||(l[4]=a=>X()),disabled:W.value},{default:t(()=>l[20]||(l[20]=[w("修改")])),_:1,__:[20]},8,["disabled"])]),_:1})),[[N,["system:role:update"]]]),v((_(),S(i,{span:1.5},{default:t(()=>[e(y,{type:"danger",icon:"delete",plain:"",onClick:l[5]||(l[5]=a=>be()),disabled:H.value},{default:t(()=>l[21]||(l[21]=[w("删除")])),_:1,__:[21]},8,["disabled"])]),_:1})),[[N,["system:role:delete"]]]),v((_(),S(i,{span:1.5},{default:t(()=>[e(y,{type:"info",icon:"Sort",plain:"",onClick:l[6]||(l[6]=a=>ce())},{default:t(()=>l[22]||(l[22]=[w("展开/折叠")])),_:1,__:[22]})]),_:1})),[[N,["system:role:add"]]]),e(ke,{showSearch:$.value,"onUpdate:showSearch":l[7]||(l[7]=a=>$.value=a),onRefreshTable:h},null,8,["showSearch"])]),_:1}),l[23]||(l[23]=ae("br",null,null,-1)),R.value?v((_(),S(Se,{key:0,border:"",data:G.value,onSelectionChange:ie,"expand-row-keys":B.value,"default-expand-all":Y.value,"row-key":"deptId","tree-props":{children:"children",hasChildren:"hasChildren"},"empty-text":"暂时没有数据哟🌻"},{default:t(()=>[e(c,{type:"selection",width:"55",align:"center"}),e(c,{label:"序号",prop:"id",width:"80px",align:"center",type:"index"}),e(c,{label:"部门名称",prop:"deptName",width:"150px",align:"left","show-overflow-tooltip":!0}),e(c,{label:"展开/折叠",prop:"isSpread",width:"100px",align:"center"},{default:t(a=>[e(ee,{modelValue:a.row.isSpread,"onUpdate:modelValue":f=>a.row.isSpread=f,"active-text":"展开","inactive-text":"折叠","active-value":"0","inactive-value":"1","inline-prompt":!0,onClick:f=>ge(a.row)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),_:1}),e(c,{label:"部门编号",prop:"deptId",width:"100px",align:"center"}),e(c,{label:"负责人",prop:"leader",width:"120px",align:"center"}),e(c,{label:"联系电话",prop:"phone",width:"120px",align:"center"}),e(c,{label:"邮箱",prop:"email",width:"230px",align:"center","show-overflow-tooltip":!0}),e(c,{label:"部门状态",prop:"deptStatus",width:"100px",align:"center"},{default:t(a=>[e(ee,{modelValue:a.row.deptStatus,"onUpdate:modelValue":f=>a.row.deptStatus=f,"active-text":"启用","inactive-text":"停用","active-value":"0","inactive-value":"1","inline-prompt":!0,onChange:f=>xe(a.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(c,{label:"显示顺序",prop:"sorted",width:"100px",align:"center"}),e(c,{label:"备注",prop:"remark",width:"180px",align:"center","show-overflow-tooltip":!0}),e(c,{label:"创建时间",prop:"createTime",width:"180px",align:"center"}),e(c,{label:"操作",align:"center",width:"120",fixed:"right"},{default:t(({row:a})=>[e(le,{content:"修改🌻",placement:"top"},{default:t(()=>[v(e(y,{type:"primary",icon:"Edit",circle:"",plain:"",onClick:f=>X(a)},null,8,["onClick"]),[[N,["system:role:update"]]])]),_:2},1024),e(le,{content:"删除🌻",placement:"top"},{default:t(()=>[v(e(y,{type:"danger",icon:"Delete",circle:"",plain:"",onClick:f=>ye(a)},null,8,["onClick"]),[[N,["system:role:delete"]]])]),_:2},1024)]),_:1})]),_:1},8,["data","expand-row-keys","default-expand-all"])),[[Ue,U.value]]):ne("",!0),e(Ie,{ref_key:"koiDialogRef",ref:V,title:P.value,onKoiConfirm:he,onKoiCancel:_e,loading:k.value},{content:t(()=>[e(j,{ref_key:"formRef",ref:O,rules:ve,model:r(o),"label-width":"80px","status-icon":""},{default:t(()=>[e(I,null,{default:t(()=>[e(i,{xs:{span:24},sm:{span:12}},{default:t(()=>[e(d,{label:"部门编码",prop:"deptId"},{default:t(()=>[e(m,{modelValue:r(o).deptId,"onUpdate:modelValue":l[8]||(l[8]=a=>r(o).deptId=a),placeholder:"请输入部门编码",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{xs:{span:24},sm:{span:12},class:"p-l-10px"},{default:t(()=>[e(d,{label:"部门名称",prop:"deptName"},{default:t(()=>[e(m,{modelValue:r(o).deptName,"onUpdate:modelValue":l[9]||(l[9]=a=>r(o).deptName=a),placeholder:"请输入部门名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(I,null,{default:t(()=>[e(i,{xs:{span:24},sm:{span:24}},{default:t(()=>[e(d,{label:"部门上级",prop:"parentId"},{default:t(()=>[e(we,{placeholder:"请选择部门上级",modelValue:r(o).parentId,"onUpdate:modelValue":l[10]||(l[10]=a=>r(o).parentId=a),options:r(E),props:{expandTrigger:"hover",emitPath:!1,checkStrictly:!0},filterable:"",clearable:"",style:{width:"540px"}},{default:t(({node:a,data:f})=>[ae("span",null,z(f.label),1),a.isLeaf?ne("",!0):(_(),te("span",Fe," ("+z(f.children.length)+") ",1))]),_:1},8,["modelValue","options"])]),_:1})]),_:1})]),_:1}),e(I,null,{default:t(()=>[e(i,{xs:{span:24},sm:{span:12}},{default:t(()=>[e(d,{label:"部门状态",prop:"deptStatus"},{default:t(()=>[e(Z,{modelValue:r(o).deptStatus,"onUpdate:modelValue":l[11]||(l[11]=a=>r(o).deptStatus=a),placeholder:"请选择部门状态",style:{width:"260px"},clearable:""},{default:t(()=>[e(q,{label:"启用",value:"0"}),e(q,{label:"停用",value:"1"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(i,{xs:{span:24},sm:{span:12},class:"p-l-10px"},{default:t(()=>[e(d,{label:"负责人",prop:"leader"},{default:t(()=>[e(m,{modelValue:r(o).leader,"onUpdate:modelValue":l[12]||(l[12]=a=>r(o).leader=a),placeholder:"请输入部门负责人",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(I,null,{default:t(()=>[e(i,{xs:{span:24},sm:{span:12}},{default:t(()=>[e(d,{label:"手机号码",prop:"phone"},{default:t(()=>[e(m,{modelValue:r(o).phone,"onUpdate:modelValue":l[13]||(l[13]=a=>r(o).phone=a),placeholder:"请输入手机号码",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{xs:{span:24},sm:{span:12},class:"p-l-10px"},{default:t(()=>[e(d,{label:"邮箱地址",prop:"email"},{default:t(()=>[e(m,{modelValue:r(o).email,"onUpdate:modelValue":l[14]||(l[14]=a=>r(o).email=a),placeholder:"请输入邮箱地址",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(I,null,{default:t(()=>[e(i,{xs:{span:24},sm:{span:12}},{default:t(()=>[e(d,{label:"显示排序",prop:"sorted"},{default:t(()=>[e(Ve,{modelValue:r(o).sorted,"onUpdate:modelValue":l[15]||(l[15]=a=>r(o).sorted=a),style:{width:"260px"},clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{xs:{span:24},sm:{span:12},class:"p-l-10px"},{default:t(()=>[e(d,{label:"备注",prop:"remark"},{default:t(()=>[e(m,{modelValue:r(o).remark,"onUpdate:modelValue":l[16]||(l[16]=a=>r(o).remark=a),placeholder:"请输入备注",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["rules","model"]),w(" "+z(r(o)),1)]),_:1},8,["title","loading"])]),_:1,__:[23]})])}}});export{He as default};
