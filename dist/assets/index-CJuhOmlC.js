import{d as W,l as g,o as xe,F as Ce,c as h,a as t,w as a,r as v,G as u,K as M,f as Z,b as be,n as P,g as d,I as G,s as m,B as n,q as c,J as Te,L as Be,M as Se,N as E,O as Le,x as Me,P as $e,Q as Pe,R as Ue,S as Fe,T as ze,U as De,V as O,z as Ie,W as Ve,X as Ke,Y as U,D as Ne,e as y,_ as Ze}from"./index-DpLe_dtH.js";import{g as Ee,a as He,s as Re,b as qe,r as Ae,c as Ge,k as Oe,d as We,e as je,u as Je}from"./index-m_r5GfhJ.js";const Qe={key:0,class:"server-status"},Xe={class:"status-indicator"},Ye={class:"status-text"},et={class:"server-controls mt-4"},tt={class:"player-count"},at={class:"quick-actions"},lt={class:"message-area"},st={class:"logs-area"},nt={key:0,class:"log-entries"},ot={class:"log-timestamp"},rt={class:"log-level"},ut={class:"log-message"},it={class:"upload-dialog-content"},dt={class:"dialog-footer"},ct=W({name:"TerrariaOverview"}),pt=W({...ct,setup(ft){const j=Ne(),i=g(null),F=g([]),$=g(!1),z=g(!1),k=g(!1),C=g(null),B=g(""),D=g(!1);let I=null;const S=g(!1),H=g([]),V=g(!1),b=g(null),w=async()=>{$.value=!0;try{const l=await Ee();i.value=l.data}catch{u.error("获取服务器状态失败")}finally{$.value=!1}},R=async()=>{z.value=!0;try{const l=await He(50);l!=null&&l.data&&(F.value=l.data)}catch{u.error("获取服务器日志失败")}finally{z.value=!1}},J=async()=>{k.value=!0;try{await Re(),u.success("服务器正在启动"),setTimeout(()=>{w()},2e3)}catch{u.error("启动服务器失败")}finally{k.value=!1}},Q=async()=>{try{await U.confirm("确定要停止服务器吗？这将断开所有玩家连接。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),k.value=!0,await qe(),u.success("服务器正在停止"),setTimeout(()=>{w()},2e3)}catch(l){l!=="cancel"&&u.error("停止服务器失败")}finally{k.value=!1}},X=async()=>{try{await U.confirm("确定要重启服务器吗？这将暂时断开所有玩家连接。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),k.value=!0,await Ae(),u.success("服务器正在重启"),setTimeout(()=>{w()},2e3)}catch(l){l!=="cancel"&&u.error("重启服务器失败")}finally{k.value=!1}},q=async()=>{if(B.value.trim()){D.value=!0;try{await Ge(B.value),u.success("消息已发送"),B.value=""}catch{u.error("发送消息失败")}finally{D.value=!1}}},Y=async l=>{try{await U.confirm("确定要踢出该玩家吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),C.value=l,await Oe(l),u.success("玩家已被踢出"),w()}catch(e){e!=="cancel"&&u.error("踢出玩家失败")}finally{C.value=null}},ee=async l=>{try{await U.confirm("确定要封禁该玩家吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),C.value=l,await We(l),u.success("玩家已被封禁"),w()}catch(e){e!=="cancel"&&u.error("封禁玩家失败")}finally{C.value=null}},te=async()=>{try{await je(),u.success("已创建备份")}catch{u.error("创建备份失败")}},x=l=>{j.push(l)},ae=l=>{switch(l){case"running":return"status-running";case"starting":return"status-starting";case"stopping":return"status-stopping";default:return"status-stopped"}},le=l=>{switch(l){case"running":return"运行中";case"starting":return"启动中";case"stopping":return"关闭中";default:return"已停止"}},se=(l,e)=>{const s=l/e;return s>.7?"#67C23A":s>.3?"#E6A23C":"#F56C6C"},ne=l=>{switch(l.toLowerCase()){case"info":return"log-info";case"warn":case"warning":return"log-warn";case"error":return"log-error";default:return""}},oe=l=>{if(!l)return"-";const e=Math.floor(l/86400),s=Math.floor(l%86400/3600),r=Math.floor(l%3600/60);let p="";return e>0&&(p+=`${e}天 `),(s>0||e>0)&&(p+=`${s}小时 `),p+=`${r}分钟`,p},re=l=>{if(!l)return"0 B";const e=["B","KB","MB","GB","TB"],s=Math.floor(Math.log(l)/Math.log(1024));return parseFloat((l/Math.pow(1024,s)).toFixed(2))+" "+e[s]},ue=()=>{S.value=!0,H.value=[],b.value=null},ie=()=>{u.warning("只能上传一个文件")},de=l=>{b.value=l.raw},ce=()=>{b.value=null},pe=l=>{const e=l.type==="application/zip"||l.name.endsWith(".zip"),s=l.size/1024/1024<100;return e?s?!0:(u.error("文件大小不能超过100MB!"),!1):(u.error("只能上传ZIP文件!"),!1)},fe=l=>{b.value=l.file},_e=async()=>{var l,e;if(!b.value){u.warning("请先选择要上传的TShock ZIP文件");return}V.value=!0;try{const s=new FormData;s.append("tshockFile",b.value);const r=await Je(s);r.data.success?(u.success("TShock服务器文件上传并安装成功!"),S.value=!1,await w()):u.error(`上传失败: ${r.data.message}`)}catch(s){u.error(`上传失败: ${((e=(l=s.response)==null?void 0:l.data)==null?void 0:e.message)||s.message}`)}finally{V.value=!1}};return xe(()=>{w(),R(),I=window.setInterval(()=>{w()},1e4)}),Ce(()=>{I&&clearInterval(I)}),(l,e)=>{const s=v("el-icon"),r=v("el-button"),p=v("el-descriptions-item"),A=v("el-progress"),ve=v("el-descriptions"),K=v("el-empty"),L=v("el-col"),T=v("el-table-column"),me=v("el-table"),ge=v("el-input"),ye=v("el-row"),we=v("el-upload"),ke=v("el-dialog"),N=be("loading");return y(),h("div",null,[t(ye,{gutter:16},{default:a(()=>[t(L,{xs:24,sm:24,md:24,lg:8,xl:8},{default:a(()=>[t(M,{header:"服务器状态",icon:"Monitor"},{headerBtn:a(()=>[t(r,{type:"primary",size:"small",onClick:w},{default:a(()=>[t(s,null,{default:a(()=>[t(c(E))]),_:1}),e[10]||(e[10]=n(" 刷新 "))]),_:1,__:[10]})]),default:a(()=>[Z((y(),h("div",null,[i.value?(y(),h("div",Qe,[d("div",Xe,[d("div",{class:G(["status-dot",ae(i.value.status)])},null,2),d("span",Ye,m(le(i.value.status)),1)]),t(ve,{column:1,border:""},{default:a(()=>[t(p,{label:"版本"},{default:a(()=>[n(m(i.value.version),1)]),_:1}),t(p,{label:"世界"},{default:a(()=>[n(m(i.value.worldName||"未选择"),1)]),_:1}),t(p,{label:"难度"},{default:a(()=>[n(m(i.value.difficulty),1)]),_:1}),t(p,{label:"玩家数"},{default:a(()=>{var o;return[n(m(((o=i.value.players)==null?void 0:o.length)||0)+" / "+m(i.value.maxPlayers),1)]}),_:1}),t(p,{label:"端口"},{default:a(()=>[n(m(i.value.port),1)]),_:1}),t(p,{label:"运行时间"},{default:a(()=>[n(m(oe(i.value.uptime)),1)]),_:1}),t(p,{label:"CPU使用率"},{default:a(()=>{var o;return[t(A,{percentage:((o=i.value)==null?void 0:o.cpuUsage)||0,"stroke-width":10,format:()=>{var f;return(((f=i.value)==null?void 0:f.cpuUsage)||0).toFixed(1)+"%"}},null,8,["percentage","format"])]}),_:1}),t(p,{label:"内存使用"},{default:a(()=>[n(m(re(i.value.memoryUsage)),1)]),_:1})]),_:1}),d("div",et,[t(r,{type:"success",disabled:i.value.status==="running"||i.value.status==="starting",onClick:J,loading:k.value},{default:a(()=>[t(s,null,{default:a(()=>[t(c(Te))]),_:1}),e[11]||(e[11]=n(" 启动服务器 "))]),_:1,__:[11]},8,["disabled","loading"]),t(r,{type:"danger",disabled:i.value.status==="stopped",onClick:Q,loading:k.value},{default:a(()=>[t(s,null,{default:a(()=>[t(c(Be))]),_:1}),e[12]||(e[12]=n(" 停止服务器 "))]),_:1,__:[12]},8,["disabled","loading"]),t(r,{type:"warning",disabled:i.value.status!=="running",onClick:X,loading:k.value},{default:a(()=>[t(s,null,{default:a(()=>[t(c(Se))]),_:1}),e[13]||(e[13]=n(" 重启服务器 "))]),_:1,__:[13]},8,["disabled","loading"])])])):(y(),P(K,{key:1,description:"暂无服务器信息"}))])),[[N,$.value]])]),_:1})]),_:1}),t(L,{xs:24,sm:24,md:24,lg:16,xl:16},{default:a(()=>[t(M,{header:"在线玩家",icon:"User"},{headerBtn:a(()=>{var o,f;return[d("span",tt,m(((f=(o=i.value)==null?void 0:o.players)==null?void 0:f.length)||0)+"人在线",1),t(r,{type:"primary",size:"small",onClick:w},{default:a(()=>[t(s,null,{default:a(()=>[t(c(E))]),_:1}),e[14]||(e[14]=n(" 刷新 "))]),_:1,__:[14]})]}),default:a(()=>{var o,f;return[Z((y(),h("div",null,[(f=(o=i.value)==null?void 0:o.players)!=null&&f.length?(y(),P(me,{key:0,data:i.value.players,style:{width:"100%"}},{default:a(()=>[t(T,{prop:"id",label:"ID",width:"60"}),t(T,{prop:"name",label:"玩家名称"}),t(T,{prop:"ip",label:"IP地址"}),t(T,{prop:"joinTime",label:"加入时间"}),t(T,{prop:"health",label:"生命值"},{default:a(_=>[t(A,{percentage:_.row.health/_.row.maxHealth*100,format:()=>`${_.row.health}/${_.row.maxHealth}`,color:se(_.row.health,_.row.maxHealth)},null,8,["percentage","format","color"])]),_:1}),t(T,{label:"操作",width:"150"},{default:a(_=>[t(r,{type:"danger",size:"small",onClick:he=>Y(_.row.id),loading:C.value===_.row.id},{default:a(()=>e[15]||(e[15]=[n(" 踢出 ")])),_:2,__:[15]},1032,["onClick","loading"]),t(r,{type:"warning",size:"small",onClick:he=>ee(_.row.id),loading:C.value===_.row.id},{default:a(()=>e[16]||(e[16]=[n(" 封禁 ")])),_:2,__:[16]},1032,["onClick","loading"])]),_:1})]),_:1},8,["data"])):(y(),P(K,{key:1,description:"暂无在线玩家"}))])),[[N,$.value]])]}),_:1})]),_:1}),t(L,{xs:24,sm:24,md:24,lg:24,xl:24},{default:a(()=>[t(M,{header:"快捷操作",icon:"Operation"},{default:a(()=>[d("div",at,[t(r,{type:"primary",onClick:e[0]||(e[0]=o=>x("/terraria/worlds"))},{default:a(()=>[t(s,null,{default:a(()=>[t(c(Le))]),_:1}),e[17]||(e[17]=n("世界管理 "))]),_:1,__:[17]}),t(r,{type:"primary",onClick:e[1]||(e[1]=o=>x("/terraria/players"))},{default:a(()=>[t(s,null,{default:a(()=>[t(c(Me))]),_:1}),e[18]||(e[18]=n("玩家管理 "))]),_:1,__:[18]}),t(r,{type:"primary",onClick:e[2]||(e[2]=o=>x("/terraria/config"))},{default:a(()=>[t(s,null,{default:a(()=>[t(c($e))]),_:1}),e[19]||(e[19]=n("服务器配置 "))]),_:1,__:[19]}),t(r,{type:"primary",onClick:e[3]||(e[3]=o=>x("/terraria/backups"))},{default:a(()=>[t(s,null,{default:a(()=>[t(c(Pe))]),_:1}),e[20]||(e[20]=n("备份管理 "))]),_:1,__:[20]}),t(r,{type:"primary",onClick:e[4]||(e[4]=o=>x("/terraria/plugins"))},{default:a(()=>[t(s,null,{default:a(()=>[t(c(Ue))]),_:1}),e[21]||(e[21]=n("插件管理 "))]),_:1,__:[21]}),t(r,{type:"primary",onClick:e[5]||(e[5]=o=>x("/terraria/logs"))},{default:a(()=>[t(s,null,{default:a(()=>[t(c(Fe))]),_:1}),e[22]||(e[22]=n("服务器日志 "))]),_:1,__:[22]}),t(r,{type:"primary",onClick:e[6]||(e[6]=o=>x("/terraria/console"))},{default:a(()=>[t(s,null,{default:a(()=>[t(c(ze))]),_:1}),e[23]||(e[23]=n("服务器控制台 "))]),_:1,__:[23]}),t(r,{type:"primary",onClick:te},{default:a(()=>[t(s,null,{default:a(()=>[t(c(De))]),_:1}),e[24]||(e[24]=n("立即备份 "))]),_:1,__:[24]}),t(r,{type:"warning",onClick:ue},{default:a(()=>[t(s,null,{default:a(()=>[t(c(O))]),_:1}),e[25]||(e[25]=n("上传TShock服务器 "))]),_:1,__:[25]})])]),_:1})]),_:1}),t(L,{xs:24,sm:24,md:24,lg:24,xl:24},{default:a(()=>[t(M,{header:"发送服务器消息",icon:"ChatDotRound"},{default:a(()=>[d("div",lt,[t(ge,{modelValue:B.value,"onUpdate:modelValue":e[7]||(e[7]=o=>B.value=o),placeholder:"输入服务器消息",clearable:"",onKeyup:Ie(q,["enter"])},{append:a(()=>[t(r,{onClick:q,loading:D.value},{default:a(()=>e[26]||(e[26]=[n("发送")])),_:1,__:[26]},8,["loading"])]),_:1},8,["modelValue"])])]),_:1})]),_:1}),t(L,{xs:24,sm:24,md:24,lg:24,xl:24},{default:a(()=>[t(M,{header:"最近日志",icon:"List"},{headerBtn:a(()=>[t(r,{type:"primary",size:"small",onClick:R},{default:a(()=>[t(s,null,{default:a(()=>[t(c(E))]),_:1}),e[27]||(e[27]=n(" 刷新 "))]),_:1,__:[27]})]),default:a(()=>{var o;return[Z((y(),h("div",st,[(o=F.value)!=null&&o.length?(y(),h("div",nt,[(y(!0),h(Ve,null,Ke(F.value,(f,_)=>(y(),h("div",{key:_,class:G(["log-entry",ne(f.level)])},[d("span",ot,m(f.timestamp),1),d("span",rt,"["+m(f.level.toUpperCase())+"]",1),d("span",ut,m(f.message),1)],2))),128))])):(y(),P(K,{key:1,description:"暂无日志信息"}))])),[[N,z.value]])]}),_:1})]),_:1})]),_:1}),t(ke,{modelValue:S.value,"onUpdate:modelValue":e[9]||(e[9]=o=>S.value=o),title:"上传TShock服务器文件",width:"500px","destroy-on-close":""},{footer:a(()=>[d("span",dt,[t(r,{onClick:e[8]||(e[8]=o=>S.value=!1)},{default:a(()=>e[32]||(e[32]=[n("取消")])),_:1,__:[32]}),t(r,{type:"primary",onClick:_e,loading:V.value},{default:a(()=>e[33]||(e[33]=[n(" 上传并安装 ")])),_:1,__:[33]},8,["loading"])])]),default:a(()=>[d("div",it,[e[30]||(e[30]=d("p",null,"如果自动下载TShock失败，您可以手动下载并上传ZIP文件",-1)),e[31]||(e[31]=d("div",{class:"download-links"},[d("h4",null,"下载链接:"),d("p",null,[d("a",{href:"https://github.com/Pryaxis/TShock/releases",target:"_blank"}," GitHub下载TShock ")]),d("p",null,"选择适用于Linux的x64版本")],-1)),t(we,{class:"tshock-uploader",action:"","http-request":fe,limit:1,"show-file-list":!0,"file-list":H.value,accept:".zip","on-exceed":ie,"on-change":de,"on-remove":ce,"before-upload":pe,drag:""},{tip:a(()=>e[28]||(e[28]=[d("div",{class:"el-upload__tip"}," 只能上传ZIP文件，且大小不超过100MB ",-1)])),default:a(()=>[t(s,{class:"el-icon--upload"},{default:a(()=>[t(c(O))]),_:1}),e[29]||(e[29]=d("div",{class:"el-upload__text"},[n(" 将TShock服务器ZIP文件拖到此处或"),d("em",null,"点击上传")],-1))]),_:1,__:[29]},8,["file-list"])])]),_:1},8,["modelValue"])])}}}),mt=Ze(pt,[["__scopeId","data-v-93322ed1"]]);export{mt as default};
