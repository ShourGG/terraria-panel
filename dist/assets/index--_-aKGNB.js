import{$ as k,d as K,l as p,o as ce,r as a,b as T,c as he,e as v,a as e,w as t,f as c,g as R,z as A,n as N,B as m,a1 as Y,p as _e,s as w,q as d,a4 as ve,a3 as E,k as B,a2 as M,E as C,a5 as we,al as be}from"./index-DpLe_dtH.js";const fe=g=>k.get("/koi/sysOperLog/listPage",g),Ne=g=>k.post("/koi/sysOperLog/deleteById/"+g),ye=g=>k.post("/koi/sysOperLog/batchDelete",g),Se=g=>k.get("/koi/sysOperLog/getDetailById/"+g),Ie={class:"koi-flex"},Te=K({name:"operlogPage"}),ke=K({...Te,setup(g){const j=p(!1),P=p(!0),x=p([{operId:"1719245754125537281",operName:"日志分页查询",operType:"EXPORT",methodName:"listPage",requestMethod:"",systemType:"PHONE",operMan:"null/超级管理员",operUrl:"",operIp:"",operLocation:"",operParam:'{"pageNo":1,"pageSize":10,"loginName":null,"ipAddress":null,"loginStatus":null,"beginTime":null,"endTime":null}',jsonResult:'{"records":[{"loginId":1631503277759787010,"loginName":"YU-ADMIN🌻","deviceName":"Unknown","ipAddress":"99.88","loginAddress":"河南省 郑州市","browser":"iOS 11 (iPhone)","os":"Chrome Mobile","loginStatus":"0","message":"登录成功","loginTime":"2023-08-25 19:13:30"},{"loginId":1631504522339807234,"loginName":"YU-ADMIN🌻","deviceName":"Unknown","ipAddress":"127.0.0.1","loginAddress":"河南省 郑州市","browser":"iOS 11 (iPhone)","os":"Chrome Mobile","loginStatus":"0","message":"登录成功","loginTime":"2023-08-25 19:13:30"},{"loginId":1631521087655362562,"loginName":"YU-ADMIN🌻","deviceName":"Unknown","ipAddress":"127.0.0.1","loginAddress":"河南省 郑州市","browser":"iOS 11 (iPhone)","os":"Chrome Mobile","loginStatus":"0","message":"登录成功","loginTime":"2023-08-25 19:13:30"},{"loginId":1631545199358406657,"loginName":"YU-ADMIN🌻","deviceName":"Unknown","ipAddress":"127.0.0.1","loginAddress":"河南省 郑州市","browser":"iOS 11 (iPhone)","os":"Chrome Mobile","loginStatus":"0","message":"登录成功","loginTime":"2023-08-25 19:13:30"},{"lo',operStatus:"0",errorMsg:"",operTime:"2023-10-31 14:51:44",costTime:"7/ms"},{operId:"1719266711737237506",operName:"日志分页查询",operType:"EXPORT",methodName:"listPage",requestMethod:"GET",systemType:"PHONE",operMan:"YU-ADMIN/超级管理员",operUrl:"/koi/sysLoginLog/listPage",operIp:"127.0.0.1",operLocation:"内网IP，无法获取位置",operParam:'{"pageNo":1,"pageSize":10,"loginName":null,"ipAddress":null,"loginStatus":null,"beginTime":null,"endTime":null}',jsonResult:'{"records":[{"loginId":1631503277759787010,"loginName":"YU-ADMIN🌻","deviceName":"Unknown","ipAddress":"99.88","loginAddress":"河南省 郑州市","browser":"iOS 11 (iPhone)","os":"Chrome Mobile","loginStatus":"0","message":"登录成功","loginTime":"2023-08-25 19:13:30"},{"loginId":1631504522339807234,"loginName":"YU-ADMIN🌻","deviceName":"Unknown","ipAddress":"127.0.0.1","loginAddress":"河南省 郑州市","browser":"iOS 11 (iPhone)","os":"Chrome Mobile","loginStatus":"0","message":"登录成功","loginTime":"2023-08-25 19:13:30"},{"loginId":1631521087655362562,"loginName":"YU-ADMIN🌻","deviceName":"Unknown","ipAddress":"127.0.0.1","loginAddress":"河南省 郑州市","browser":"iOS 11 (iPhone)","os":"Chrome Mobile","loginStatus":"0","message":"登录成功","loginTime":"2023-08-25 19:13:30"},{"loginId":1631545199358406657,"loginName":"YU-ADMIN🌻","deviceName":"Unknown","ipAddress":"127.0.0.1","loginAddress":"河南省 郑州市","browser":"iOS 11 (iPhone)","os":"Chrome Mobile","loginStatus":"0","message":"登录成功","loginTime":"2023-08-25 19:13:30"},{"lo',operStatus:"1",errorMsg:"",operTime:"2023-10-31 16:15:01",costTime:"112/ms"},{operId:"1719266961520615426",operName:"日志分页查询",operType:"EXPORT",methodName:"listPage",requestMethod:"GET",systemType:"PHONE",operMan:"YU-ADMIN/超级管理员",operUrl:"/koi/sysLoginLog/listPage",operIp:"127.0.0.1",operLocation:"内网IP，无法获取位置",operParam:'{"pageNo":1,"pageSize":10,"loginName":null,"ipAddress":null,"loginStatus":null,"beginTime":null,"endTime":null}',jsonResult:"",operStatus:"1",errorMsg:"",operTime:"2023-10-31 16:16:01",costTime:"111/ms"}]),r=p({pageNo:1,pageSize:10,operName:"",operIp:"",operMan:""}),y=p(0),S=p(),H=()=>{S.value=[],r.value={pageNo:1,pageSize:10,operName:"",operIp:"",operMan:""}},q=()=>{r.value.pageNo=1,u()},$=()=>{H(),u()},u=async()=>{y.value=200},I=async()=>{try{const n=await fe(be(r.value,S.value));x.value=n.data.records,y.value=n.data.total}catch{M("数据查询失败，请刷新重试🌻")}};ce(()=>{u()});const D=p([]),X=p(!0),O=p(!0),G=n=>{D.value=n.map(o=>o.operId),X.value=n.length!=1,O.value=!n.length},F=n=>{const o=n.operId;(o==null||o=="")&&ve("请选中需要删除的数据🌻"),E("您确认需要删除操作名称["+n.operName+"]么？").then(async()=>{try{await Ne(o),I(),B("删除成功🌻")}catch{I(),M("删除失败，请刷新重试🌻")}}).catch(()=>{C("已取消🌻")})},W=()=>{if(D.value.length==0){we("请选择需要删除的数据🌻");return}E("您确认需要进行批量删除么？").then(async()=>{try{await ye(D.value),I(),B("批量删除成功🌻")}catch{M("批量删除失败，请刷新重试🌻"),I()}}).catch(()=>{C("已取消🌻")})},J=async n=>{const o=n.operId;o||C("请传递需要查询的条件🌻"),Q(),L.value="描述列表";try{const h=await Se(o);i.value=h.data}catch{M("数据查询失败，请刷新重试🌻")}V.value.koiOpen()},V=p(),L=p("描述列表");let i=p({methodName:"",operParam:"",jsonResult:"",operStatus:"",errorMsg:"",costTime:""});const Q=()=>{i.value={methodName:"",operParam:"",jsonResult:"",operStatus:"",errorMsg:"",costTime:""}};return(n,o)=>{const h=a("el-input"),b=a("el-form-item"),Z=a("el-date-picker"),f=a("el-button"),ee=a("el-form"),oe=a("el-col"),te=a("KoiToolbar"),le=a("el-row"),s=a("el-table-column"),z=a("el-tooltip"),ae=a("el-table"),ne=a("el-pagination"),_=a("el-descriptions-item"),re=a("el-tag"),ie=a("el-descriptions"),se=a("KoiDialog"),pe=a("KoiCard"),de=T("debounce"),ue=T("throttle"),U=T("auth"),me=T("loading");return v(),he("div",Ie,[e(pe,null,{default:t(()=>[c(e(ee,{inline:!0},{default:t(()=>[e(b,{label:"操作名称",prop:"operName"},{default:t(()=>[e(h,{placeholder:"请输入操作名称",modelValue:r.value.operName,"onUpdate:modelValue":o[0]||(o[0]=l=>r.value.operName=l),style:{width:"200px"},clearable:"",onKeyup:A(u,["enter","native"])},null,8,["modelValue"])]),_:1}),e(b,{label:"IP地址",prop:"operIp"},{default:t(()=>[e(h,{placeholder:"请输入IP地址",modelValue:r.value.operIp,"onUpdate:modelValue":o[1]||(o[1]=l=>r.value.operIp=l),style:{width:"200px"},clearable:"",onKeyup:A(u,["enter","native"])},null,8,["modelValue"])]),_:1}),e(b,{label:"操作人员",prop:"operMan"},{default:t(()=>[e(h,{placeholder:"请输入操作人员名字",modelValue:r.value.operMan,"onUpdate:modelValue":o[2]||(o[2]=l=>r.value.operMan=l),style:{width:"200px"},clearable:"",onKeyup:A(u,["enter","native"])},null,8,["modelValue"])]),_:1}),e(b,{label:"访问时间",prop:"loginTime"},{default:t(()=>[e(Z,{modelValue:S.value,"onUpdate:modelValue":o[3]||(o[3]=l=>S.value=l),type:"datetimerange","value-format":"YYYY-MM-DD HH:mm:ss","start-placeholder":"开始日期","range-separator":"至","end-placeholder":"结束日期","default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)]},null,8,["modelValue","default-time"])]),_:1}),e(b,null,{default:t(()=>[c((v(),N(f,{type:"primary",icon:"search",plain:""},{default:t(()=>o[8]||(o[8]=[m("搜索")])),_:1,__:[8]})),[[de,q]]),c((v(),N(f,{type:"danger",icon:"refresh",plain:""},{default:t(()=>o[9]||(o[9]=[m("重置")])),_:1,__:[9]})),[[ue,$]])]),_:1})]),_:1},512),[[Y,P.value]]),e(le,{gutter:10},{default:t(()=>[c((v(),N(oe,{span:1.5},{default:t(()=>[e(f,{type:"danger",icon:"delete",plain:"",onClick:o[4]||(o[4]=l=>W()),disabled:O.value},{default:t(()=>o[10]||(o[10]=[m("删除")])),_:1,__:[10]},8,["disabled"])]),_:1})),[[U,["system:role:delete"]]]),e(te,{showSearch:P.value,"onUpdate:showSearch":o[5]||(o[5]=l=>P.value=l),onRefreshTable:u},null,8,["showSearch"])]),_:1}),o[11]||(o[11]=R("br",null,null,-1)),c((v(),N(ae,{border:"",data:x.value,"empty-text":"暂时没有数据哟🌻",onSelectionChange:G},{default:t(()=>[e(s,{type:"selection",width:"55",align:"center"}),e(s,{label:"序号",prop:"operId",width:"70px",align:"center",type:"index"}),e(s,{label:"操作名称",prop:"operName",width:"180px",align:"center","show-overflow-tooltip":!0}),e(s,{label:"操作类型",prop:"operType",width:"120px",align:"center","show-overflow-tooltip":!0}),e(s,{label:"系统类型",prop:"systemType",width:"120px",align:"center","show-overflow-tooltip":!0}),e(s,{label:"请求方式",prop:"requestMethod",width:"100px",align:"center","show-overflow-tooltip":!0}),e(s,{label:"操作人员[登录名/用户名]",prop:"operMan",width:"200px",align:"center","show-overflow-tooltip":!0}),e(s,{label:"请求URL",prop:"operUrl",width:"200px",align:"center","show-overflow-tooltip":!0}),e(s,{label:"操作IP",prop:"operIp",width:"200px",align:"center","show-overflow-tooltip":!0}),e(s,{label:"操作地点",prop:"operLocation",width:"180px",align:"center","show-overflow-tooltip":!0}),e(s,{label:"操作时间",prop:"operTime",width:"180px",align:"center","show-overflow-tooltip":!0}),e(s,{label:"操作",align:"center",width:"120",fixed:"right"},{default:t(({row:l})=>[e(z,{content:"删除🌻",placement:"top"},{default:t(()=>[c(e(f,{type:"danger",icon:"Delete",circle:"",plain:"",onClick:ge=>F(l)},null,8,["onClick"]),[[U,["system:role:delete"]]])]),_:2},1024),e(z,{content:"查看🌻",placement:"top"},{default:t(()=>[c(e(f,{type:"primary",icon:"View",circle:"",plain:"",onClick:ge=>J(l)},null,8,["onClick"]),[[U,["system:role:list"]]])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[me,j.value]]),o[12]||(o[12]=R("br",null,null,-1)),c(e(ne,{background:"","current-page":r.value.pageNo,"onUpdate:currentPage":o[6]||(o[6]=l=>r.value.pageNo=l),"page-size":r.value.pageSize,"onUpdate:pageSize":o[7]||(o[7]=l=>r.value.pageSize=l),"page-sizes":[10,20,50,100,200],layout:"total, sizes, prev, pager, next, jumper",total:y.value,onSizeChange:u,onCurrentChange:u},null,8,["current-page","page-size","total"]),[[Y,y.value>0]]),e(se,{ref_key:"koiDialogRef",ref:V,title:L.value,top:"6vh",height:660,width:800,footerHidden:!0},{content:t(()=>[e(ie,{direction:"vertical",column:3,border:""},{default:t(()=>[e(_,{label:"方法名称"},{default:t(()=>[m(w(d(i).methodName),1)]),_:1}),e(_,{label:"消耗时间[毫秒]"},{default:t(()=>[m(w(d(i).costTime),1)]),_:1}),e(_,{label:"操作状态"},{default:t(()=>[e(re,{type:d(i).operStatus=="0"?"":d(i).operStatus=="1"?"danger":"warning"},{default:t(()=>[m(w(d(i).operStatus=="0"?"操作成功":d(i).operStatus=="1"?"操作失败":"未知状态"),1)]),_:1},8,["type"])]),_:1}),d(i).operStatus=="1"?(v(),N(_,{key:0,label:"异常信息",span:3},{default:t(()=>[m(w(d(i).costTime),1)]),_:1})):_e("",!0),e(_,{label:"请求参数",span:3},{default:t(()=>[m(w(d(i).operParam),1)]),_:1}),e(_,{label:"返回数据",span:3},{default:t(()=>[m(w(d(i).jsonResult),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1,__:[11,12]})])}}});export{ke as default};
